var ye=Object.defineProperty;var $e=(s,e,t)=>e in s?ye(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var I=(s,e,t)=>($e(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const O=window,J=O.ShadowRoot&&(O.ShadyCSS===void 0||O.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,K=Symbol(),G=new WeakMap;let he=class{constructor(e,t,n){if(this._$cssResult$=!0,n!==K)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(J&&e===void 0){const n=t!==void 0&&t.length===1;n&&(e=G.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&G.set(t,e))}return e}toString(){return this.cssText}};const ge=s=>new he(typeof s=="string"?s:s+"",void 0,K),we=(s,...e)=>{const t=s.length===1?s[0]:e.reduce((n,i,r)=>n+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+s[r+1],s[0]);return new he(t,s,K)},Ae=(s,e)=>{J?s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet):e.forEach(t=>{const n=document.createElement("style"),i=O.litNonce;i!==void 0&&n.setAttribute("nonce",i),n.textContent=t.cssText,s.appendChild(n)})},Z=J?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return ge(t)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var L;const j=window,X=j.trustedTypes,Se=X?X.emptyScript:"",Y=j.reactiveElementPolyfillSupport,V={toAttribute(s,e){switch(e){case Boolean:s=s?Se:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch{t=null}}return t}},de=(s,e)=>e!==s&&(e==e||s==s),D={attribute:!0,type:String,converter:V,reflect:!1,hasChanged:de},W="finalized";let w=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(e){var t;this.finalize(),((t=this.h)!==null&&t!==void 0?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach((t,n)=>{const i=this._$Ep(n,t);i!==void 0&&(this._$Ev.set(i,n),e.push(i))}),e}static createProperty(e,t=D){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const n=typeof e=="symbol"?Symbol():"__"+e,i=this.getPropertyDescriptor(e,n,t);i!==void 0&&Object.defineProperty(this.prototype,e,i)}}static getPropertyDescriptor(e,t,n){return{get(){return this[t]},set(i){const r=this[e];this[t]=i,this.requestUpdate(e,r,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||D}static finalize(){if(this.hasOwnProperty(W))return!1;this[W]=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),e.h!==void 0&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const t=this.properties,n=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const i of n)this.createProperty(i,t[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const i of n)t.unshift(Z(i))}else e!==void 0&&t.push(Z(e));return t}static _$Ep(e,t){const n=t.attribute;return n===!1?void 0:typeof n=="string"?n:typeof e=="string"?e.toLowerCase():void 0}u(){var e;this._$E_=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(e=this.constructor.h)===null||e===void 0||e.forEach(t=>t(this))}addController(e){var t,n;((t=this._$ES)!==null&&t!==void 0?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((n=e.hostConnected)===null||n===void 0||n.call(e))}removeController(e){var t;(t=this._$ES)===null||t===void 0||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])})}createRenderRoot(){var e;const t=(e=this.shadowRoot)!==null&&e!==void 0?e:this.attachShadow(this.constructor.shadowRootOptions);return Ae(t,this.constructor.elementStyles),t}connectedCallback(){var e;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$ES)===null||e===void 0||e.forEach(t=>{var n;return(n=t.hostConnected)===null||n===void 0?void 0:n.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)===null||e===void 0||e.forEach(t=>{var n;return(n=t.hostDisconnected)===null||n===void 0?void 0:n.call(t)})}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$EO(e,t,n=D){var i;const r=this.constructor._$Ep(e,n);if(r!==void 0&&n.reflect===!0){const o=(((i=n.converter)===null||i===void 0?void 0:i.toAttribute)!==void 0?n.converter:V).toAttribute(t,n.type);this._$El=e,o==null?this.removeAttribute(r):this.setAttribute(r,o),this._$El=null}}_$AK(e,t){var n;const i=this.constructor,r=i._$Ev.get(e);if(r!==void 0&&this._$El!==r){const o=i.getPropertyOptions(r),l=typeof o.converter=="function"?{fromAttribute:o.converter}:((n=o.converter)===null||n===void 0?void 0:n.fromAttribute)!==void 0?o.converter:V;this._$El=r,this[r]=l.fromAttribute(t,o.type),this._$El=null}}requestUpdate(e,t,n){let i=!0;e!==void 0&&(((n=n||this.constructor.getPropertyOptions(e)).hasChanged||de)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),n.reflect===!0&&this._$El!==e&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(e,n))):i=!1),!this.isUpdatePending&&i&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((i,r)=>this[r]=i),this._$Ei=void 0);let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),(e=this._$ES)===null||e===void 0||e.forEach(i=>{var r;return(r=i.hostUpdate)===null||r===void 0?void 0:r.call(i)}),this.update(n)):this._$Ek()}catch(i){throw t=!1,this._$Ek(),i}t&&this._$AE(n)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)===null||t===void 0||t.forEach(n=>{var i;return(i=n.hostUpdated)===null||i===void 0?void 0:i.call(n)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){this._$EC!==void 0&&(this._$EC.forEach((t,n)=>this._$EO(n,this[n],t)),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}};w[W]=!0,w.elementProperties=new Map,w.elementStyles=[],w.shadowRootOptions={mode:"open"},Y==null||Y({ReactiveElement:w}),((L=j.reactiveElementVersions)!==null&&L!==void 0?L:j.reactiveElementVersions=[]).push("1.6.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var B;const R=window,A=R.trustedTypes,ee=A?A.createPolicy("lit-html",{createHTML:s=>s}):void 0,k="$lit$",m=`lit$${(Math.random()+"").slice(9)}$`,fe="?"+m,qe=`<${fe}>`,$=document,P=()=>$.createComment(""),T=s=>s===null||typeof s!="object"&&typeof s!="function",_e=Array.isArray,Ee=s=>_e(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",z=`[ 	
\f\r]`,E=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,te=/-->/g,ne=/>/g,x=RegExp(`>|${z}(?:([^\\s"'>=/]+)(${z}*=${z}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),ie=/'/g,se=/"/g,pe=/^(?:script|style|textarea|title)$/i,Ce=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),b=Ce(1),S=Symbol.for("lit-noChange"),f=Symbol.for("lit-nothing"),re=new WeakMap,y=$.createTreeWalker($,129,null,!1),Pe=(s,e)=>{const t=s.length-1,n=[];let i,r=e===2?"<svg>":"",o=E;for(let a=0;a<t;a++){const c=s[a];let _,u,h=-1,p=0;for(;p<c.length&&(o.lastIndex=p,u=o.exec(c),u!==null);)p=o.lastIndex,o===E?u[1]==="!--"?o=te:u[1]!==void 0?o=ne:u[2]!==void 0?(pe.test(u[2])&&(i=RegExp("</"+u[2],"g")),o=x):u[3]!==void 0&&(o=x):o===x?u[0]===">"?(o=i??E,h=-1):u[1]===void 0?h=-2:(h=o.lastIndex-u[2].length,_=u[1],o=u[3]===void 0?x:u[3]==='"'?se:ie):o===se||o===ie?o=x:o===te||o===ne?o=E:(o=x,i=void 0);const v=o===x&&s[a+1].startsWith("/>")?" ":"";r+=o===E?c+qe:h>=0?(n.push(_),c.slice(0,h)+k+c.slice(h)+m+v):c+m+(h===-2?(n.push(void 0),a):v)}const l=r+(s[t]||"<?>")+(e===2?"</svg>":"");if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return[ee!==void 0?ee.createHTML(l):l,n]};class U{constructor({strings:e,_$litType$:t},n){let i;this.parts=[];let r=0,o=0;const l=e.length-1,a=this.parts,[c,_]=Pe(e,t);if(this.el=U.createElement(c,n),y.currentNode=this.el.content,t===2){const u=this.el.content,h=u.firstChild;h.remove(),u.append(...h.childNodes)}for(;(i=y.nextNode())!==null&&a.length<l;){if(i.nodeType===1){if(i.hasAttributes()){const u=[];for(const h of i.getAttributeNames())if(h.endsWith(k)||h.startsWith(m)){const p=_[o++];if(u.push(h),p!==void 0){const v=i.getAttribute(p.toLowerCase()+k).split(m),g=/([.?@])?(.*)/.exec(p);a.push({type:1,index:r,name:g[2],strings:v,ctor:g[1]==="."?Ue:g[1]==="?"?Ne:g[1]==="@"?Oe:H})}else a.push({type:6,index:r})}for(const h of u)i.removeAttribute(h)}if(pe.test(i.tagName)){const u=i.textContent.split(m),h=u.length-1;if(h>0){i.textContent=A?A.emptyScript:"";for(let p=0;p<h;p++)i.append(u[p],P()),y.nextNode(),a.push({type:2,index:++r});i.append(u[h],P())}}}else if(i.nodeType===8)if(i.data===fe)a.push({type:2,index:r});else{let u=-1;for(;(u=i.data.indexOf(m,u+1))!==-1;)a.push({type:7,index:r}),u+=m.length-1}r++}}static createElement(e,t){const n=$.createElement("template");return n.innerHTML=e,n}}function q(s,e,t=s,n){var i,r,o,l;if(e===S)return e;let a=n!==void 0?(i=t._$Co)===null||i===void 0?void 0:i[n]:t._$Cl;const c=T(e)?void 0:e._$litDirective$;return(a==null?void 0:a.constructor)!==c&&((r=a==null?void 0:a._$AO)===null||r===void 0||r.call(a,!1),c===void 0?a=void 0:(a=new c(s),a._$AT(s,t,n)),n!==void 0?((o=(l=t)._$Co)!==null&&o!==void 0?o:l._$Co=[])[n]=a:t._$Cl=a),a!==void 0&&(e=q(s,a._$AS(s,e.values),a,n)),e}class Te{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:n},parts:i}=this._$AD,r=((t=e==null?void 0:e.creationScope)!==null&&t!==void 0?t:$).importNode(n,!0);y.currentNode=r;let o=y.nextNode(),l=0,a=0,c=i[0];for(;c!==void 0;){if(l===c.index){let _;c.type===2?_=new M(o,o.nextSibling,this,e):c.type===1?_=new c.ctor(o,c.name,c.strings,this,e):c.type===6&&(_=new je(o,this,e)),this._$AV.push(_),c=i[++a]}l!==(c==null?void 0:c.index)&&(o=y.nextNode(),l++)}return y.currentNode=$,r}v(e){let t=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class M{constructor(e,t,n,i){var r;this.type=2,this._$AH=f,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=i,this._$Cp=(r=i==null?void 0:i.isConnected)===null||r===void 0||r}get _$AU(){var e,t;return(t=(e=this._$AM)===null||e===void 0?void 0:e._$AU)!==null&&t!==void 0?t:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=q(this,e,t),T(e)?e===f||e==null||e===""?(this._$AH!==f&&this._$AR(),this._$AH=f):e!==this._$AH&&e!==S&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):Ee(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==f&&T(this._$AH)?this._$AA.nextSibling.data=e:this.$($.createTextNode(e)),this._$AH=e}g(e){var t;const{values:n,_$litType$:i}=e,r=typeof i=="number"?this._$AC(e):(i.el===void 0&&(i.el=U.createElement(i.h,this.options)),i);if(((t=this._$AH)===null||t===void 0?void 0:t._$AD)===r)this._$AH.v(n);else{const o=new Te(r,this),l=o.u(this.options);o.v(n),this.$(l),this._$AH=o}}_$AC(e){let t=re.get(e.strings);return t===void 0&&re.set(e.strings,t=new U(e)),t}T(e){_e(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,i=0;for(const r of e)i===t.length?t.push(n=new M(this.k(P()),this.k(P()),this,this.options)):n=t[i],n._$AI(r),i++;i<t.length&&(this._$AR(n&&n._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var n;for((n=this._$AP)===null||n===void 0||n.call(this,!1,!0,t);e&&e!==this._$AB;){const i=e.nextSibling;e.remove(),e=i}}setConnected(e){var t;this._$AM===void 0&&(this._$Cp=e,(t=this._$AP)===null||t===void 0||t.call(this,e))}}class H{constructor(e,t,n,i,r){this.type=1,this._$AH=f,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=r,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=f}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,n,i){const r=this.strings;let o=!1;if(r===void 0)e=q(this,e,t,0),o=!T(e)||e!==this._$AH&&e!==S,o&&(this._$AH=e);else{const l=e;let a,c;for(e=r[0],a=0;a<r.length-1;a++)c=q(this,l[n+a],t,a),c===S&&(c=this._$AH[a]),o||(o=!T(c)||c!==this._$AH[a]),c===f?e=f:e!==f&&(e+=(c??"")+r[a+1]),this._$AH[a]=c}o&&!i&&this.j(e)}j(e){e===f?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class Ue extends H{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===f?void 0:e}}const Me=A?A.emptyScript:"";class Ne extends H{constructor(){super(...arguments),this.type=4}j(e){e&&e!==f?this.element.setAttribute(this.name,Me):this.element.removeAttribute(this.name)}}class Oe extends H{constructor(e,t,n,i,r){super(e,t,n,i,r),this.type=5}_$AI(e,t=this){var n;if((e=(n=q(this,e,t,0))!==null&&n!==void 0?n:f)===S)return;const i=this._$AH,r=e===f&&i!==f||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,o=e!==f&&(i===f||r);r&&this.element.removeEventListener(this.name,this,i),o&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,n;typeof this._$AH=="function"?this._$AH.call((n=(t=this.options)===null||t===void 0?void 0:t.host)!==null&&n!==void 0?n:this.element,e):this._$AH.handleEvent(e)}}class je{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){q(this,e)}}const oe=R.litHtmlPolyfillSupport;oe==null||oe(U,M),((B=R.litHtmlVersions)!==null&&B!==void 0?B:R.litHtmlVersions=[]).push("2.7.4");const Re=(s,e,t)=>{var n,i;const r=(n=t==null?void 0:t.renderBefore)!==null&&n!==void 0?n:e;let o=r._$litPart$;if(o===void 0){const l=(i=t==null?void 0:t.renderBefore)!==null&&i!==void 0?i:null;r._$litPart$=o=new M(e.insertBefore(P(),l),l,void 0,t??{})}return o._$AI(s),o};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Q,F;class C extends w{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const n=super.createRenderRoot();return(e=(t=this.renderOptions).renderBefore)!==null&&e!==void 0||(t.renderBefore=n.firstChild),n}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Re(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!1)}render(){return S}}C.finalized=!0,C._$litElement$=!0,(Q=globalThis.litElementHydrateSupport)===null||Q===void 0||Q.call(globalThis,{LitElement:C});const ae=globalThis.litElementPolyfillSupport;ae==null||ae({LitElement:C});((F=globalThis.litElementVersions)!==null&&F!==void 0?F:globalThis.litElementVersions=[]).push("3.3.2");function le(s,e=[]){do{const t=s&127;s>>>=7,e.push(t|(s===0?0:128))}while(s>0);return e}function me(s,e=0){let t=e,n=(s[e]&127)<<0;return 128&s[e++]&&(n|=(s[e]&127)<<7,128&s[e++]&&(n|=(s[e]&127)<<14,128&s[e++]&&(n|=(s[e]&127)<<21))),[n,e,t]}const ve=He();function He(){let s=new Map,e=[[1,"u8","payload_format_indicator"],[2,"u32","message_expiry_interval"],[3,"utf8","content_type"],[8,"utf8","response_topic"],[9,"bin","correlation_data"],[11,"vint","subscription_identifier"],[17,"u32","session_expiry_interval"],[18,"utf8","assigned_client_identifier"],[19,"u16","server_keep_alive"],[21,"utf8","authentication_method"],[22,"bin","authentication_data"],[23,"u8","request_problem_information"],[24,"u32","will_delay_interval"],[25,"u8","request_response_information"],[26,"utf8","response_information"],[28,"utf8","server_reference"],[31,"utf8","reason_string"],[33,"u16","receive_maximum"],[34,"u16","topic_alias_maximum"],[35,"u16","topic_alias"],[36,"u8","maximum_qos"],[37,"u8","retain_available"],[38,"pair","user_properties",{op:"kv_obj"}],[39,"u32","maximum_packet_size"],[40,"u8","wildcard_subscription_available"],[41,"u8","subscription_identifiers_available",{op:"u8_vec"}],[42,"u8","shared_subscription_available"]];for(let[t,n,i,r]of e){let o={id:t,type:n,name:i,...r};s.set(o.id,o),s.set(o.name,o)}return s}class Ie extends Number{static of(e,t,n){var r;let i=new this(e);return i.reason=((r=n==null?void 0:n[t])==null?void 0:r.get(e))||t,i}}class Le{static of(e){return this.prototype.of(e)}of(e){let t=(n,i)=>(i=0|t.k,t.k=i+n,i);return{__proto__:this,buf:e,step:t}}has_more(){return this.buf.byteLength>(this.step.k|0)}u8(){return this.buf[this.step(1)]}u16(){let{buf:e,step:t}=this,n=t(2);return e[n]<<8|e[n+1]}u32(){let{buf:e,step:t}=this,n=t(4);return e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]}vint(){let{buf:e,step:t}=this,[n,i,r]=me(e,t.k|0);return t(i-r),n}bin(){let{buf:e,step:t}=this,n=t(2),i=e[n]<<8|e[n+1];return n=t(i),e.subarray(n,n+i)}utf8(){return new TextDecoder("utf-8").decode(this.bin())}pair(){return[this.utf8(),this.utf8()]}flags(e){return new e(this.buf[this.step(1)])}reason(e){let t=this.buf[this.step(1)];if(t!=null)return Ie.of(t,e,this._reasons_by)}flush(){let{buf:e,step:t}=this;return this.step=this.buf=null,e.subarray(t.k|0)}}class De extends Le{props(){let{buf:e,step:t}=this,[n,i,r]=me(e,t.k|0);if(t(n+i-r),n===0)return null;let o={},l=this.of(e.subarray(i,t.k|0));for(;l.has_more();){let a=ve.get(l.u8()),c=l[a.type]();o[a.name]=a.op?l[a.op](o[a.name],c):c}return o}kv_obj(e=Object.create(null),[t,n]){return e[t]=n,e}u8_vec(e=[],t){return e.push(t),e}}function Be(s,...e){s=class extends s{static reasons(t,...n){var o;let i=this.prototype;i._reasons_by={...i._reasons_by};let r=(o=i._reasons_by)[t]||(o[t]=new Map);for(let[l,a]of n)r.set(l,a);return this}};for(let t of e)t(s);return s}class ze{static of(){return this.prototype.of()}of(){return{__proto__:this,$:[]}}static init(){return this}as_pkt(e){return this.pack([e])}push(...e){this.$.push(...e)}pack(e){let t,n,i=0,r=this.$;this.$=!1;for(t of r)i+=t.length;e=le(i,e),n=e.length;let o=new Uint8Array(n+i);o.set(e,0);for(t of r)o.set(t,n),n+=t.length;return o}u8(e){this.push([e&255])}u16(e){this.push([e>>>8&255,e&255])}u32(e){this.push([e>>>24&255,e>>>16&255,e>>>8&255,e&255])}vint(e){this.push(le(e))}bin(e){if(!e)return this.u16(0);if(typeof e=="string")return this.utf8(e);e.length!==e.byteLength&&(e=new Uint8Array(e)),this.u16(e.byteLength),this.push(e)}utf8(e){let t=new TextEncoder("utf-8").encode(e);this.u16(t.byteLength),this.push(t)}pair(e,t){this.utf8(e),this.utf8(t)}flags(e,t,n=0){return e!==void 0&&isNaN(+e)&&(e=t(e,0)),e|=n,this.push([e]),e}reason(e){this.push([e|0])}flush(e){e!=null&&this.push(typeof e=="string"?new TextEncoder("utf-8").encode(e):e),this.push=!1}}class Qe extends ze{props(e){if(!e)return this.u8(0);if(Array.isArray(e)||(e=e.entries?Array.from(e.entries()):Object.entries(e)),e.length===0)return this.u8(0);let t=this.of();for(let[n,i]of e){let r=ve.get(n);t[r.op||"one"](i,r)}this.push(t.pack())}one(e,t){this.u8(t.id),this[t.type](e)}kv_obj(e,t){for(let n of Object.entries(e))this.u8(t.id),this.pair(n)}u8_vec(e,t){for(let n of e)this.u8(t.id),this.u8(n)}}function Fe(s,e){class t extends Number{get session_present(){return this&!0}}return s[2]=(n,i)=>{let r=e.of(i);return n.flags=r.flags(t),n.reason=r.reason(n.type),5<=n.mqtt_level&&(n.props=r.props()),n}}function Ve(s){s.reasons("connack",[0,"Success"],[1,"Connection refused, unacceptable protocol version"],[2,"Connection refused, identifier rejected"],[3,"Connection refused, server unavailable"],[4,"Connection refused, bad user name or password"],[5,"Connection refused, not authorized"])}function We(s){Ve(s),s.reasons("connack",[129,"Malformed Packet"],[130,"Protocol Error"],[131,"Implementation specific error"],[132,"Unsupported Protocol Version"],[133,"Client Identifier not valid"],[134,"Bad User Name or Password"],[135,"Not authorized"],[136,"Server unavailable"],[137,"Server busy"],[138,"Banned"],[140,"Bad authentication method"],[144,"Topic Name invalid"],[149,"Packet too large"],[151,"Quota exceeded"],[153,"Payload format invalid"],[154,"Retain not supported"],[155,"QoS not supported"],[156,"Use another server"],[157,"Server moved"],[159,"Connection rate exceeded"])}function ke(s,e){return s[3]=(t,n)=>{let{hdr:i}=t;t.dup=!!(i&8),t.retain=!!(i&1);let r=t.qos=i>>1&3,o=e.of(n);return t.topic=o.utf8(),r!==0&&(t.pkt_id=o.u16()),5<=t.mqtt_level&&(t.props=o.props()),t.payload=o.flush(),t}}function Je(s,e){return s[4]=(t,n)=>{let i=e.of(n);return t.pkt_id=i.u16(),5<=t.mqtt_level&&(t.reason=i.reason(t.type),t.props=i.props()),t}}function Ke(s){s.reasons("puback",[0,"Success"],[16,"No matching subscribers"],[128,"Unspecified error"],[131,"Implementation specific error"],[135,"Not authorized"],[144,"Topic Name invalid"],[145,"Packet identifier in use"],[151,"Quota exceeded"],[153,"Payload format invalid"])}function xe(s){return(e,t)=>{let n=s.of(t);e.pkt_id=n.u16(),5<=e.mqtt_level&&(e.props=n.props());let i=e.answers=[];for(;n.has_more();)i.push(n.reason(e.type));return e}}function Ge(s,e){return s[9]=xe(e)}function Ze(s){s.reasons("suback",[0,"Granted QoS 0"],[1,"Granted QoS 1"],[2,"Granted QoS 2"])}function Xe(s){Ze(s),s.reasons("suback",[128,"Unspecified error"],[131,"Implementation specific error"],[135,"Not authorized"],[143,"Topic Filter invalid"],[145,"Packet Identifier in use"],[151,"Quota exceeded"],[158,"Shared Subscriptions not supported"],[161,"Subscription Identifiers not supported"],[162,"Wildcard Subscriptions not supported"])}function Ye(s,e){return s[11]=xe(e)}function et(s){s.reasons("unsuback",[0,"Success"],[17,"No subscription existed"],[128,"Unspecified error"],[131,"Implementation specific error"],[135,"Not authorized"],[143,"Topic Filter invalid"],[145,"Packet Identifier in use"])}function tt(s){return s[12]=s[13]=e=>e}function nt(s,e){return s[14]=(t,n)=>{if(n&&5<=t.mqtt_level){let i=e.of(n);t.reason=i.reason(t.type),t.props=i.props()}return t}}function it(s){s.reasons("disconnect",[0,"Normal disconnection"],[4,"Disconnect with Will Message"],[128,"Unspecified error"],[129,"Malformed Packet"],[130,"Protocol Error"],[131,"Implementation specific error"],[135,"Not authorized"],[137,"Server busy"],[139,"Server shutting down"],[141,"Keep Alive timeout"],[142,"Session taken over"],[143,"Topic Filter invalid"],[144,"Topic Name invalid"],[147,"Receive Maximum exceeded"],[148,"Topic Alias invalid"],[149,"Packet too large"],[150,"Message rate too high"],[151,"Quota exceeded"],[152,"Administrative action"],[153,"Payload format invalid"],[154,"Retain not supported"],[155,"QoS not supported"],[156,"Use another server"],[157,"Server moved"],[158,"Shared Subscriptions not supported"],[159,"Connection rate exceeded"],[160,"Maximum connect time"],[161,"Subscription Identifiers not supported"],[162,"Wildcard Subscriptions not supported"])}function st(s,e){return s[15]=(t,n)=>{if(5<=t.mqtt_level){let i=e.of(n);t.reason=i.reason(t.type),t.props=i.props()}return t}}function rt(s){s.reasons("auth",[0,"Success"],[24,"Continue authentication"],[25,"Re-authenticate"])}function ot(s,e){const t=new Uint8Array([0,4,77,81,84,84]),n=r=>0|(r.reserved?1:0)|(r.will_qos&3)<<3|(r.clean_start?2:0)|(r.will_flag?4:0)|(r.will_retain?32:0)|(r.password?64:0)|(r.username?128:0),i=r=>4|(r.qos&3)<<3|(r.retain?32:0);return s.connect=(r,o)=>{let l=e.of(o);l.push(t),l.u8(r);let{will:a,username:c,password:_}=o,u=l.flags(o.flags,n,0|(c?128:0)|(_?64:0)|(a?i(a):0));return l.u16(o.keep_alive),5<=r&&l.props(o.props),l.utf8(o.client_id),u&4&&(5<=r&&l.props(a.props),l.utf8(a.topic),l.bin(a.payload)),u&128&&l.utf8(c),u&64&&l.bin(_),l.as_pkt(16)}}function at(s,e){return s.publish=(t,n)=>{let i=(n.qos&3)<<1,r=e.of(n);return r.utf8(n.topic),i!==0&&r.u16(n.pkt_id),5<=t&&r.props(n.props),r.flush(n.payload),r.as_pkt(48|i|(n.dup?8:0)|(n.retain?1:0))}}function lt(s,e){return s.puback=(t,n)=>{let i=e.of(n);return i.u16(n.pkt_id),5<=t&&(i.reason(n.reason),i.props(n.props)),i.as_pkt(64)}}function ct(s,e){const t=n=>0|n.qos&3|(n.retain?4:0)|(n.retain_handling&3)<<2;return s.subscribe=(n,i)=>{let r=e.of(i);r.u16(i.pkt_id),5<=n&&r.props(i.props);let o=t(i);for(let l of i.topics)if(typeof l=="string")r.utf8(l),r.u8(o);else{let[a,c]=Array.isArray(l)?l:[l.topic,l.opts];r.utf8(a),c===void 0?r.u8(o):r.flags(c,t)}return r.as_pkt(130)}}function ut(s,e){return s.unsubscribe=(t,n)=>{let i=e.of(n);i.u16(n.pkt_id),5<=t&&i.props(n.props);for(let r of n.topics)i.utf8(r);return i.as_pkt(162)}}function ht(s){s.pingreq=()=>new Uint8Array([192,0]),s.pingresp=()=>new Uint8Array([208,0])}function dt(s,e){return s.disconnect=(t,n)=>{let i=e.of(n);return n&&5<=t&&(n.reason||n.props)&&(i.reason(n.reason),i.props(n.props)),i.as_pkt(224)}}function ft(s,e){return s.auth=(t,n)=>{if(5>t)throw new Error("Auth packets are only available after MQTT 5.x");let i=e.of(n);return i.reason(n.reason),i.props(n.props),i.as_pkt(240)}}const _t=[Fe,ke,Je,Ge,Ye,tt,nt,st],pt=[ot,lt,at,ct,ut,ht,dt,ft],mt=Be(De,We,Ke,Xe,et,it,rt),vt={decode_fns:_t,mqtt_reader:mt,encode_fns:pt,mqtt_writer:Qe};function xt(s,e=0){let t=e,n=(s[e]&127)<<0;return 128&s[e++]&&(n|=(s[e]&127)<<7,128&s[e++]&&(n|=(s[e]&127)<<14,128&s[e++]&&(n|=(s[e]&127)<<21))),[n,e,t]}function bt(s){let e=new Uint8Array(0);return t=>{e=e.byteLength===0?t:yt(e,t);let n=[];for(;;){let[i,r]=xt(e,1),o=i+r;if(e.byteLength<o)return n;let l=e[0],a=i===0?null:e.subarray(r,o);e=e.subarray(o);let c=s.decode_pkt(l,a,s);c!=null&&n.push(c)}}}function yt(s,e){let t=s.byteLength,n=new Uint8Array(t+e.byteLength);return n.set(s,0),n.set(e,t),n}const $t=["~","connect","connack","publish","puback","pubrec","pubrel","pubcomp","subscribe","suback","unsubscribe","unsuback","pingreq","pingresp","disconnect","auth"];function gt(s,e,t){t={__proto__:t||e.pkt_ctx,mqtt_level:s,get hdr(){return this.b0&15},get id(){return this.b0>>>4},get type(){return $t[this.b0>>>4]}};let n,i=[],r={};for(n of e.encode_fns)n(r,e.mqtt_writer);for(n of e.decode_fns)n(i,e.mqtt_reader);return{pkt_ctx:t,encode_pkt(o,l){return r[o](s,l)},decode_pkt(o,l){let a=i[o>>>4]||i[0];return a==null?void 0:a({__proto__:this.pkt_ctx,b0:o},l)},mqtt_stream(){let o={__proto__:this,pkt_ctx:{__proto__:t}};return o.pkt_ctx._base_=o.pkt_ctx,o.decode=bt(o),o}}}function wt(s=(...e)=>e){let e,t,n=(i,r)=>{e=i,t=r};return i=>(i=new Promise(n),s(i,e,t))}const N=wt();Promise.resolve({type:"init"});function At(s,[e,t]){let n=N(),i=N(),r=async(...a)=>(await i[0])(...a),o,l;return s._send=r,{async when_ready(){await i[0]},ping:St(()=>o==null?void 0:o("pingreq")),reset(a){o&&(a&&n[2](a),o=null,n=N(),s._send=r,s.conn_emit("on_disconnect",a===!1,a))},async send_connect(...a){o||await n[0];let c=await o(...a);return c[0].reason==0&&(l=!0,i[1](s._send=o),i=N(),s.conn_emit("on_ready")),c},is_set:()=>!!o,set(a,c){if(o)throw new Error("Already connected");a=a.mqtt_stream();let _={mqtt:s},u=h=>e(a.decode(h),_);return o=async(h,p,v)=>{let g=v!==void 0?t(v):!0;return await c(a.encode_pkt(h,p)),g},n[1](o),s.conn_emit("on_live",l),u}}}function St(s){let e;return t=>{var n;if(e=clearInterval(e),t)return e=setInterval(s,1e3*t),(n=e.unref)==null||n.call(e),!0}}function qt(s,e){if(s instanceof RegExp)return{keys:!1,pattern:s};var t,n,i,r,o=[],l="",a=s.split("/");for(a[0]||a.shift();i=a.shift();)t=i[0],t==="*"?(o.push("wild"),l+="/(.*)"):t===":"?(n=i.indexOf("?",1),r=i.indexOf(".",1),o.push(i.substring(1,~n?n:~r?r:i.length)),l+=~n&&!~r?"(?:/([^/]+?))?":"/([^/]+?)",~r&&(l+=(~n?"?":"")+"\\"+i.substring(r))):l+="/"+i;return{keys:o,pattern:new RegExp("^"+l+(e?"(?=$|/)":"/?$"),"i")}}function Et(s,e,t){t.done=!0}function Ct(){let s=[[],[]],e=Symbol(),t=n=>Pt(s,n);return{find:t,add(n,...i){let r=i.pop(),o=i.pop();if(typeof r!="function")if(r===!1)r=Et;else throw new TypeError;let l=qt(n.replace(/[+#]$/,"*"));return l.key=n,l.tgt=r,s[o?0:1].push(l),this},remove(n,i){let r=s[i?0:1];return ce([r],n)},clear(n){s[n?0:1]=[],n==null&&(s[1]=[])},async invoke(n,i){i.idx=0,i.rm=e;for(let[l,a]of t(n.topic)){let c=await l(n,a,i);if(e===c&&ce(s,l),i.done)break;i.idx++}let{pkt_id:r,qos:o}=n;o===1&&await i.mqtt._send("puback",{pkt_id:r})}}}function*Pt(s,e){for(let t of s)for(let n of t){let i=Tt(e,n);i!==void 0&&(yield i)}}function Tt(s,{keys:e,pattern:t,tgt:n}){let i=s[0]!=="/"?t.exec("/"+s):t.exec(s);if(i===null)return;if(e===!1){let{groups:o}=i;if(!o)return[n];let l={};for(let a in o)l[a]=o[a];return[n,l]}if(e.length===0)return[n];let r={};for(let o=0;o<e.length;o++)r[e[o]]=i[1+o];return[n,r]}function ce(s,e){let t=n=>n===e||n.tgt===e||n.key===e;for(let n of s){let i=n.findIndex(t);if(0<=i)return!!n.splice(i,1)}return!1}const Ut={create(s){return{__proto__:this,target:s,hashbelt:[new Map]}},bind_pkt_future(s=100){let{hashbelt:e}=this,t,n=i=>e[0].set(t,i);return i=>(typeof i=="string"?t=i:(s=s+1&65535,t=i.pkt_id=s),new Promise(n))},answer(s,e){for(let t of this.hashbelt){let n=t.get(s);if(n!==void 0)return t.delete(s),n([e]),!0}return!1},rotate_belt(s){let{hashbelt:e}=this;e.unshift(new Map);for(let t of e.splice(s||5))for(let n of t.values())n([,"expired"])},cmdids:(()=>{return[()=>{},t,e,t,s,s,s,s,t,s,t,s,e,e,t,e];function s(n,i){n.answer(i.pkt_id,i)}function e(n,i,r){n.answer(i.type,i),t(n,i,r)}async function t({target:n},i,r){let o=n[`mqtt_${i.type}`]||n.mqtt_pkt;o!==void 0&&await o.call(n,i,r)}})()};function Mt(s,e){let t=Ut.create(e),{cmdids:n}=t,{td:i=1e3,n:r=5}=s&&s.rotate||{},o=i+Date.now();return[l,t.bind_pkt_future()];function l(a,c){for(let _ of a)n[_.id](t,_,c);Date.now()>o&&(t.rotate_belt(r),o=i+Date.now())}}class Nt extends Error{constructor(e,t=e.reason){super(`[0x${t.toString(16)}] ${t.reason}`),this.mqtt_pkt=e,this.reason=t}}class be{constructor(e={}){this._conn_=At(this,this._init_dispatch(e,this))}async conn_emit(e,t,n){var i;(i=this.log_conn)==null||i.call(this,e,t,n);try{let r=this[await e];r?await r.call(this,this,t,n):n&&await this.on_error(n,e)}catch(r){this.on_error(r,e)}}on_error(e,t){console.warn("[[u8-mqtt error: %s]]",t,e)}async connect(e={}){let t=e.client_id||["u8-mqtt--",""];Array.isArray(t)&&(e.client_id=t=this.init_client_id(t)),this.client_id=t,e.keep_alive==null&&(e.keep_alive=60);let n=await this._conn_.send_connect("connect",e,"connack");if(n[0].reason!=0)throw new this.MQTTError(n[0]);return this._conn_.ping(e.keep_alive),n}async disconnect(e={}){let t=await this._send("disconnect",e);return this._conn_.reset(!1),t}auth(e={}){return this._send("auth",e,"auth")}ping(){return this._send("pingreq",null,"pingresp")}subscribe(e,t){return e=ue(e,t),this._send("subscribe",e,e)}_sub_chain(e,t){let n=this.subscribe([[e]],t),i=this.subs||(this.subs=new Map);return i.set(n.topic=e,i.last=n),this}unsubscribe(e,t){return e=ue(e,t),this._send("unsubscribe",e,e)}get on_topic(){return this.router.add}subscribe_topic(e,...t){this.router.add(e,!0,t.pop());let n=this.topic_for(e);return this._sub_chain(n,t.pop())}unsubscribe_topic(e){this.router.remove(e,!0);let t=this.topic_for(e);return this.unsubscribe([[t]])}shared_subscribe(e,t,...n){this.router.add(t,!0,n.pop());let i=this.topic_for(t);return e!=null&&(i=`$share/${e}/${i}`),this._sub_chain(i,n.pop())}shared_unsubscribe(e,t){this.router.remove(t,!0);let n=this.topic_for(t);return e!=null&&(n=`$share/${e}/${n}`),this.unsubscribe([[n]])}topic_for(e){return e.replace(/[:*].*$/,"#")}publish(e,t){return d(this,e,t)}post(e,t,n){return d.m(this,e,t,n)}send(e,t,n){return d.mq(this,e,t,n)}store(e,t,n){return d.mqr(this,e,t,n)}json_post(e,t,n){return d.o(this,e,t,n)}json_send(e,t,n){return d.oq(this,e,t,n)}json_store(e,t,n){return d.oqr(this,e,t,n)}obj_post(e,t,n){return d.o(this,e,t,n)}obj_send(e,t,n){return d.oq(this,e,t,n)}obj_store(e,t,n){return d.oqr(this,e,t,n)}init_client_id(e){let t=this.client_id;return t===void 0&&(this.client_id=t=this.sess_client_id(e)),t}new_client_id(e){return[e[0],Math.random().toString(36).slice(2),e[1]].join("")}sess_client_id(e){let t=e.join(" "),n=sessionStorage.getItem(t);return n==null&&(n=this.new_client_id(e),sessionStorage.setItem(t,n)),n}_init_router(e){return this.router=Ct()}_init_dispatch(e){let t={__proto__:e.on_mqtt_type||{},router:this._init_router(e,this)};return t.mqtt_publish||(t.mqtt_publish=t.router.invoke),Mt(this,t)}}{let s=be.prototype;Object.assign(s,{MQTTError:Nt,pub:s.publish,sub:s.subscribe,unsub:s.unsubscribe,sub_topic:s.subscribe_topic,unsub_topic:s.unsubscribe_topic,shared_sub:s.shared_subscribe,shared_unsub:s.shared_unsubscribe})}function ue(s,e){return typeof s=="string"?{topics:[s],...e}:s[Symbol.iterator]?{topics:[...s],...e}:e?{...s,...e}:s}async function d(s,e,t){if(e.payload===void 0){typeof t=="function"&&(t={fn_encode:t});let{msg:n}=e;switch(typeof n){case"function":t={...t,fn_encode:n};case"undefined":return r=>d(s,{...e,[e.arg||"payload"]:r},t);default:let{fn_encode:i}=t||{};e.payload=i?await i(n):JSON.stringify(n)}}return t&&(t.props&&(e.props=t.props),t.xform&&(e=t.xform(e)||e)),s._send("publish",e,e.qos?e:void 0)}Object.assign(d,{m:(s,e,t,n)=>d(s,{topic:e,payload:t,qos:0},n),mq:(s,e,t,n)=>d(s,{topic:e,payload:t,qos:1},n),mqr:(s,e,t,n)=>d(s,{topic:e,payload:t,qos:1,retain:1},n),o:(s,e,t,n)=>d(s,{topic:e,msg:t,arg:"msg",qos:0},n),oq:(s,e,t,n)=>d(s,{topic:e,msg:t,arg:"msg",qos:1},n),oqr:(s,e,t,n)=>d(s,{topic:e,msg:t,arg:"msg",qos:1,retain:1},n)});const Ot={utf8(s){return new TextDecoder("utf-8").decode(s||this.payload)},json(s){return JSON.parse(this.utf8(s)||null)},text(s){return this.utf8(s)}};class jt extends be{constructor(e={}){super(e),this.with(e)}static mqtt_ctx(e,t,n=Ot){let i=class extends this{};return i.prototype.mqtt_ctx=gt(e,t,n),i}with(e){for(let[t,n]of Object.entries(e))typeof n=="function"&&(this[t]=n);return this}on_live(e,t){if(t)return e.connect()}_use_conn(e){var t;return(t=this.reconnect=e)==null?void 0:t()}with_autoreconnect(e=2e3){return e.toFixed&&(e={delay:e}),this.with({on_reconnect(){this.delay(e.delay||2e3).then(this.reconnect).then(e.reconnect,e.error)}})}on_disconnect(e,t){var n;if(!t)return(n=e.on_reconnect)==null?void 0:n.call(e)}delay(e){return new Promise(t=>setTimeout(t,e))}with_async_iter(e,t){let n=this._conn_.set(this.mqtt_ctx,t);return this._msg_loop=(async()=>{try{e=await e;for await(let i of e)n(i);this._conn_.reset()}catch(i){this._conn_.reset(i)}})(),this}with_stream(e,t){return t===void 0&&(t=e),this.with_async_iter(e,n=>t.write(n))}with_websock(e){if(!(e!=null&&e.send))return e=new URL(e||"ws://127.0.0.1:9001"),this._use_conn(()=>this.with_websock(new WebSocket(e,["mqtt"])));e.binaryType="arraybuffer";let t,{readyState:n}=e;if(n!==1){if(n!==0)throw new Error("Invalid WebSocket readyState");t=new Promise(o=>e.onopen=o)}let{_conn_:i}=this,r=i.set(this.mqtt_ctx,async o=>(await t,e.send(o)));return e.onmessage=o=>r(new Uint8Array(o.data)),e.onclose=o=>{if(!o.wasClean){var l=new Error("websocket connection close");l.code=o.code,l.reason=o.reason}i.reset(l)},this}}const Rt=jt.mqtt_ctx(4,vt),Ht=s=>new Rt(s);class It extends C{constructor(){super();I(this,"clientMqtt");I(this,"values");console.log("constructor",2),this.hasConnection=!1,this.hasDeviceConnection=!1}static get properties(){return{hasConnection:{type:Boolean},hasDeviceConnection:{type:Boolean}}}async connMqtt(){var i;let t=null;localStorage.getItem("mqttClientId")?t=localStorage.getItem("mqttClientId"):(t=(((i=navigator==null?void 0:navigator.userAgentData)==null?void 0:i.platform)||(navigator==null?void 0:navigator.platform)||"unown")+"_"+Math.random().toString(16).substr(2,8),localStorage.setItem("mqttClientId",t)),console.log("connMqtt","ClientID",t);let n=this;this.clientMqtt=Ht().with_websock("wss://"+this.values.mqttHost).with_autoreconnect({delay:2e3,reconnect:()=>{n.cb_reconnect()},error:()=>{n.cb_error()}}),this.clientMqtt.with({on_live:()=>{n.cb_on_live()}}),await this.clientMqtt.connect({client_id:t,username:this.values.mqttUsername,password:this.values.mqttPassword})}cb_reconnect(){console.log("reconnect","reconnected"),this.hasConnection=!0}cb_error(){this.hasConnection=!1,console.log("error","errored")}cb_on_live(){this.hasConnection=!0,console.log("on_live","Connected"),this.clientMqtt.subscribe_topic("/hello",this.cb_subscribe)}cb_subscribe(t,n,i){console.log(subscribe_topic,"topic packet",n,t,t.json()),this.hasDeviceConnection=!0}async _onClick2(){await this.clientMqtt.send(this.values.mqttTopicAbrir,this.values.mqttPayload),console.log("_onClick2","Cliquei"),alert("Portão accionado"),this.renderRoot.querySelector("#mqttButton").toggleAttribute("disabled",!0),setTimeout(()=>{this.renderRoot.querySelector("#mqttButton").toggleAttribute("disabled"),console.log("_onClick2","Ativei")},2*1e3)}async firstUpdated(){await this.fetchData()}async fetchData(){let t;t=await fetch("./json_profiles/quinta_azevinho.json").then(n=>n.json()),t!=null&&(this.values=t,this.requestUpdate(),console.log("fetchData","Fetched Json"),this.connMqtt())}static get styles(){return we`
      :host {
        max-width: 1280px;
        margin: 0 auto;
        padding: 2rem;
        text-align: center;
      }

      .logo {
        height: 23vh;
        border-radius: 32px;
        border: 2px solid transparent;
        padding: 1.5em;
        will-change: filter;
        transition: filter 300ms;
      }
      .logo:hover {
        filter: drop-shadow(0 0 2em #646cffaa);
      }

      .card {
        padding: 2em;
      }

      a {
        font-weight: 500;
        color: #646cff;
        text-decoration: inherit;
      }
      a:hover {
        color: #535bf2;
      }

      button {
        border-radius: 8px;
        border: 1px solid transparent;
        padding: 0.6em 1.2em;
        font-size: 2em;
        font-weight: 500;
        font-family: inherit;
        background-color: #1a1a1a;
        cursor: pointer;
        transition: border-color 0.25s;
      }
      button:hover {
        border-color: #646cff;
      }
      button:focus,
      button:focus-visible {
        outline: 4px auto -webkit-focus-ring-color;
      }

      @media (prefers-color-scheme: light) {
        a:hover {
          color: #747bff;
        }
        button {
          background-color: #f9f9f9;
        }
      }
    `}headerTemplate(){return b`<header>${this.article.title}</header>`}bodyTemplate(){return this.values==null?b`loading`:b`
    <p style="font-size:2em">
      ${this.values.appPerfil.nome}
    </p>
    <div>
      <img src="${this.values.appPerfil.imagem}" alt="Logo" class="logo"></img>
    </div>
    <div class="card">
      <button id="mqttButton" @click=${this._onClick2} part="button">
      🚪 Abrir Portão 
      </button>
    </div>`}footerTemplate(){return b`
    <footer>
      <p id="hasConnection">${this.hasConnection?b`🟢`:"🔴"} | ${this.hasDeviceConnection?b`🟢`:"🔴"}</p>
      <p>Versão:${2}</p>
    </footer>`}render(){return b`
      ${this.bodyTemplate()}
      ${this.footerTemplate()}
    `}}window.customElements.define("my-app",It);
